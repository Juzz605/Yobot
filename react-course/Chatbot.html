<!DOCTYPE html>
<html>
  <head>
    <title>Yobot</title>
    <style>
      html, body {
        margin: 0;
        padding: 0;
        height: 100%;
      }

      .Name{
        font-family: Arial, Helvetica, sans-serif;
      }
      .profile-pic {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        object-fit: cover;
      }

      .send-button{
        background-color: lightseagreen;
        color: antiquewhite;
        padding: 12px 15px;
        font-size: 16px;
        border: none;
        border-radius: 12px;
        margin-left: 12px;
        cursor: pointer;
        margin-bottom: 10px;
      }
      .chat-input{
        padding: 12px 15px;
        border-radius: 10px;
        border-width: 1px;
        font-size: 15px;
        flex-grow: 1;
        margin-bottom: 10px;

      }
      .chat-div{
        display: flex;
        
      }
      .app-div{
        max-width: 600px;
        margin-left: auto;
        margin-right: auto;
        height: 100vh;
        display: flex;
        flex-direction: column;
        

      }
      .chat-user{
        display: flex;
        justify-content: end;
        margin-top: 12px;

      }
      .chat-robot{
        display: flex;
      }

      .chat-text {
        background-color: gainsboro;
        padding: 12px 15px;
        margin-left: 12px;
        margin: 12px;
        border-radius: 12px;
         font-family: Arial;
         margin-right: 12px;
         max-width: 300px;
       
      }

      .chat-messages{
        flex-grow: 1;
        margin-top: 20px;
        overflow: scroll;
        scrollbar-width: none;
        
      }
    </style>
  </head>
  <body>
    <div class="js-container"></div>
    
    </script>

    <script src="https://unpkg.com/supersimpledev/react.js"></script>
    <script src="https://unpkg.com/supersimpledev/react-dom.js"></script>
    <script src="chatbot.js"></script>
    <script src="https://unpkg.com/supersimpledev/babel.js"></script>
    <script type="text/babel">

      function Name(){
        return(
          <div>
            <h2 className='Name'>Yobot</h2>
            </div>

        );
      }

      function ChatInput({chatMessages,setChatMessages}) {
        const [inputText,setInputText]=React.useState("");

        function saveInputText(event){
          setInputText(event.target.value);
        }

        function sendMessages(){
          const newChatMessages = [
            ...chatMessages,
            {
              message : inputText,
              sender : 'user',
              index : crypto.randomUUID()
            }
          ]
          setChatMessages();
          

          const response = Chatbot.getResponse(inputText);
          setChatMessages([
            ...newChatMessages,
            {
              message : response,
              sender : 'robot',
              index : crypto.randomUUID()
            }
          ]);
          setInputText('');

        }

        return(
          <div className='chat-div'>
            <input className='chat-input' placeholder="Send a message to the chabot" size="30" onChange = {saveInputText} value={inputText}/>
            <button onClick={sendMessages} className = 'send-button'>Send</button>
            </div>
        );

      }

      function ChatMessage({message , sender}){
        return (
          <div className={sender === 'user' ? 'chat-user' : 'chat-robot'} >
            {sender === 'robot' && <img src ="image.png" width="45" className='profile-pic'/> }
           <div className='chat-text'>
            {message} </div>
            {sender === 'user' && <img src="user.png" width="45" className='profile-pic' />}
          </div>

        );
      }

      function ChatMessages({chatMessages}){
        const chatMessagesRef = React.useRef(null);

        React.useEffect(()=>{
          const chatMessagesElem = chatMessagesRef.current;
          if(chatMessagesElem){
            chatMessagesElem.scrollTop = chatMessagesElem.scrollHeight;
          }
        },[chatMessages]);
        
        return(
          <div className='chat-messages' ref = {chatMessagesRef}>
          
          {chatMessages.map((chat, index) => {
                  return (
                    <ChatMessage
                       key={index}
                       message={chat.message}
                       sender={chat.sender}
                    />
                  );
                })}
          </div>
        )
      }

      function App(){
        const [chatMessages , setChatMessages ] = React.useState([ 

          { message : 'Yoo im Yobot!!' , sender : 'robot',index:'id1'},
          // { message : 'Hello! how can i help you!', sender : 'robot',index:'id2'},
        ])
        return (

        <div className='app-div'>
          <Name/>
          <ChatMessages chatMessages = {chatMessages}/>
          <ChatInput 
          chatMessages = {chatMessages}
          setChatMessages = {setChatMessages}
          />
        </div>

      )}

      const container = document.querySelector('.js-container');
      ReactDOM.createRoot(container).render(<App />);

    </script>
  </body>
</html>